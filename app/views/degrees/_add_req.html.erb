<div id="cblist">
</div>

<input type="text" id="txtName" />
<input type="button" value="Add Requirement" id="btnSave" />
<input type="button" value="Save Requrements" id="btnSaveDegree" />

<script type="text/javascript">
$.reqVars = new Object();
$.reqVars.reqs = "<%= @degree.degree_requirements.to_s %>".split(";");

if (!($.reqVars.reqs.length == 1 && $.reqVars.reqs[0] == "")) {
   for (var i=0; i<$.reqVars.reqs.length; i++) {
      var container = $('#cblist');
      var inputs = container.find('input');
      status = $.reqVars.reqs[i][$.reqVars.reqs[i].length - 1];
      $.reqVars.reqs[i] = $.reqVars.reqs[i].slice(0,$.reqVars.reqs[i].length - 1);
      if (status == '1') {
         $('<input />', { type: 'checkbox', id: 'cb'+ (i+1), data_id: (i+1).toString(), value: $.reqVars.reqs[i], checked: 'checked' }).appendTo(container);
      } else {
         $('<input />', { type: 'checkbox', id: 'cb'+ (i+1), data_id: (i+1).toString(), value: $.reqVars.reqs[i] }).appendTo(container);
      }
      $('<label />', { 'for': 'cb'+ (i+1), data_id: (i+1).toString(), text: $.reqVars.reqs[i], id: 'lb' + (i+1) }).appendTo(container);
      $('<input />', { type: 'button', data_id: (i+1).toString(), value: 'x', db_id: 'db'+(i+1), id: 'btnDelete' + (i+1), class: 'btnDelete' }).appendTo(container);
      $('<br>').appendTo(container);
   }
} else {
   $.reqVars.reqs = new Array;
}

$.reqVars.deleted = new Array;
for (var i=0; i<$.reqVars.reqs.length; i++){
   $.reqVars.deleted[i] = 0;
}


$(document).ready(function() {
    $('#btnSave').click(function() {
        addCheckbox($('#txtName').val());
	$('#txtName').val("");
    });
});

$(document).ready(function() {
    $('#btnSaveDegree').click(function() {
        saveRequirements($('#txtName').val());
    });
});

$(document).ready(function() {
    $('[id^=btnDelete]').click(function() {
        removeCheckbox($(this).attr("db_id"));
    });
});

function removeCheckbox(id) {
   id_num = parseInt(id.slice(2));
   $.reqVars.deleted[id_num-1] = 1;
   $('#cb' + id_num).remove();
   $('#lb' + id_num).remove();
   $('#btnDelete' + id_num).remove();
}

function addCheckbox(name) {
   var container = $('#cblist');
   var inputs = container.find('input');
   var id = $.reqVars.reqs.length + 1;
   $.reqVars.reqs[$.reqVars.reqs.length] = name;
   $.reqVars.deleted.push(0);
  
   $('<input />', { type: 'checkbox', data_id:  id.toString(), id: 'cb'+id, value: name }).appendTo(container);
   $('<label />', { 'for': 'cb'+id, data_id: id.toString(), text: name, id: 'lb' + id }).appendTo(container);
   $('<input />', { type: 'button', data_id: id.toString(), value: 'x', db_id: 'db'+id, id: 'btnDelete' + id, class: 'btnDelete' }).appendTo(container);
   $('<br>').appendTo(container);
   $(document).ready(function() {
      $('[id^=btnDelete]').click(function() {
         removeCheckbox($(this).attr("db_id"));
      });
   });

}

function saveRequirements(name) {
   var tempReqs = $.reqVars.reqs.slice(0);
   for (var i=$.reqVars.reqs.length-1; i>=0; i--) {
      if ($.reqVars.deleted[i] == 1) {
         tempReqs.splice(i,1);
      } else if ($('#cb'+(i+1)).prop('checked')) {
	 tempReqs[i] += "1";
      } else {
	 tempReqs[i] += "0";      
      }
   }
   var reqString = tempReqs.join(";");
   $.ajax({url: "/degrees/"+<%= @degree.id.to_s %>+ "/addReq",
    data: {"req": reqString},
    dataType: 'html',
    success: function(response,status) { alert("Degree Successfully Saved"); },
    error: function(x,y,z) { alert("Error Saving Degree: " + y); }}
    );
}

</script>

