<head>
    <script type="text/javascript">
    
    $(document).ready(function() {
      var coursesArray = <%= @courses.to_json.html_safe %>;
      var data = new Array();
      var index = 0;
      <% @courses.each do |course| %>
        var el = {id: index, text: '<%= course.course_code %>' + ': ' + '<%= course.course_name %>'};
        data.push(el);
        index++;
      <% end %>
      $.each(data,function(index,value){
        $('.js-example-data-array').append('<option value="' + (data[index].id+1) + '">'+data[index].text+'</option>');
      });
      
      $(".js-example-data-array").select2({
        placeholder: "Search course",
      });

      $(".panel-title").click(function() {
        var course_code = $("#course_code").text();
      });

      $('.js-example-data-array').change(function(){
        //$('#course_added').append('<p>' + $(this).find('option:selected').html() + '</p>');
        var selectedCourse = $(this).find('option:selected').html();
        var searchedCourse = findCourse(coursesArray, selectedCourse);
        //$(".panel-title").text(selectedCourse);
        //$(".panel-body").text(findCourse(coursesArray, selectedCourse).course_description);
        //$("#accordion").removeClass('hidden');

        window.location.href = "/users/" + searchedCourse.id + "/addCourse?" + "user_id=" + '<%= @user.id %>';
        /*$.ajax({
            url:   "/users/" + searchedCourse.id + "/addCourse",
            data:  {'user_id': '<%= @user.id %>'},
        }).done(function( msg ) {
          alert( "Data Saved: " + msg );
        });*/
      });
    });
    
    function findCourse(courses, selectedCourse){
      for(i=0; i<courses.length; i++){
        if(selectedCourse=== (courses[i].course_code + ': ' + courses[i].course_name))
          return courses[i];
      }
      return null;
    }

  </script>
</head>

<h1>Search Course</h1>


<select class="js-example-data-array" style="width:23%">
  <option></option>
</select>

<div id="course_added"><br></div>

<div class="panel-group" id="accordion">
  <% @user.courses.each do |course| %>
      <div class="panel panel-primary" style="width:23%">
        <div class="panel-heading"> 
          <div class="panel-title">
            <p id="course_code"><%= course.course_code %>:</p>
            <p id="course_name"><%= course.course_name%></p>
          </div>
          <%= link_to 'x', remCourse_user_path(user_id: @user, course_id: course), {data: { confirm: 'Are you sure?' }, :style=>"color:white;float:right"} %>
          <a data-toggle="collapse-description" data-parent="#accordion"
                href="#accordion<%= course.id %>" style="color:white">
              View course description
          </a>
          <a data-toggle="collapse-lectures" data-parent="#accordion"
              href="#accordion<%= @user.id %>" style="color:white">
            Lectures
          </a>
        </div>
        <div id="accordion<%= course.id %>" class="panel-collapse collapse-description">
          <div class="panel-body">
            <%= course.course_description %>
          </div>
        </div>
        <div id="accordion<%=course.id %>" class="panel-collapse collapse-lectures">
          <div class="panel-body">


            <%= form_tag addSection_user_path(user_id: @user,course_id: course), :method => :put do %>

              <%course.Wintersections.each_with_index do |section,i| %>
                <li><%= radio_button_tag("section_ids", section[0]) %>
                  <%= label_tag("section_ids", section[0]) %></li>
              <% end %>

                <%= submit_tag("Update")%>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  
      
</div>